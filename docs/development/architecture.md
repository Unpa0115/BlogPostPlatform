# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

BlogPostPlatformã®ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã¨æŠ€è¡“ä»•æ§˜ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚   Backend       â”‚    â”‚   External      â”‚
â”‚   (Next.js)     â”‚â—„â”€â”€â–ºâ”‚   (API Routes)  â”‚â—„â”€â”€â–ºâ”‚   Services      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI Components â”‚    â”‚   Database      â”‚    â”‚   OpenAI        â”‚
â”‚   (React)       â”‚    â”‚   (SQLite)      â”‚    â”‚   Whisper API   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   State Mgmt    â”‚    â”‚   Encryption    â”‚    â”‚   YouTube       â”‚
â”‚   (Context)     â”‚    â”‚   (AES-256)     â”‚    â”‚   Data API      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   File Upload   â”‚    â”‚   Credential    â”‚    â”‚   Browserless   â”‚
â”‚   (Multer)      â”‚    â”‚   Storage       â”‚    â”‚   (Voicy)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

```typescript
// ä¸»è¦æŠ€è¡“
const frontendStack = {
  framework: "Next.js 14.2.25",
  language: "TypeScript 5.2.2",
  ui: "React 18.2.0",
  styling: "Tailwind CSS 3.4.1",
  components: "Shadcn/ui + Radix UI",
  icons: "Lucide React 0.446.0",
  state: "React Context + Custom Hooks",
};
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

```typescript
// ä¸»è¦æŠ€è¡“
const backendStack = {
  runtime: "Node.js 18+",
  framework: "Next.js API Routes",
  database: "SQLite 3 + sqlite library",
  authentication: "Custom JWT + bcryptjs",
  encryption: "Node.js crypto + bcryptjs",
  fileProcessing: "Multer + fluent-ffmpeg",
};
```

### å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹

```typescript
// å¤–éƒ¨API
const externalServices = {
  openai: "Whisper API + GPT-4o-mini",
  youtube: "YouTube Data API v3",
  browserless: "Browserless.io + Playwright",
  railway: "Railway Deployment Platform",
  spotify: "RSS Feed Generation",
  voicy: "Browser Automation",
};
```

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API Routes
â”‚   â”‚   â”œâ”€â”€ auth/          # èªè¨¼é–¢é€£
â”‚   â”‚   â”œâ”€â”€ platforms/     # ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é€£æº
â”‚   â”‚   â”œâ”€â”€ uploads/       # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â”‚   â”‚   â””â”€â”€ rss/           # RSS Feedç”Ÿæˆ
â”‚   â”œâ”€â”€ globals.css        # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”œâ”€â”€ layout.tsx         # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â””â”€â”€ page.tsx           # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
â”œâ”€â”€ components/            # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ui/               # å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ upload-form.tsx   # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â””â”€â”€ distribution-manager.tsx # é…ä¿¡ç®¡ç†
â”œâ”€â”€ lib/                  # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”œâ”€â”€ database.ts       # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
â”‚   â”œâ”€â”€ encryption.ts     # æš—å·åŒ–æ©Ÿèƒ½
â”‚   â”œâ”€â”€ voicyAutomation.ts # Voicyè‡ªå‹•åŒ–
â”‚   â””â”€â”€ youtube.ts        # YouTube API
â”œâ”€â”€ hooks/                # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ use-platforms.ts # ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†
â”‚   â””â”€â”€ use-toast.ts     # é€šçŸ¥ç®¡ç†
â”œâ”€â”€ contexts/             # React Context
â”‚   â””â”€â”€ auth-context.tsx # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
â””â”€â”€ types/               # TypeScriptå‹å®šç¾©
    â””â”€â”€ index.ts         # å…±é€šå‹å®šç¾©
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### èªè¨¼æƒ…å ±ã®æš—å·åŒ–

```typescript
// src/lib/auth.ts
import bcrypt from 'bcryptjs'
import jwt from 'jsonwebtoken'

// JWT_SECRETã®å–å¾—ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯å¿…é ˆï¼‰
function getJwtSecret(): string {
  const secret = process.env.JWT_SECRET
  
  if (!secret) {
    if (process.env.NODE_ENV === 'production') {
      throw new Error('JWT_SECRETç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯å¿…é ˆã§ã™ã€‚')
    }
    
    // é–‹ç™ºç’°å¢ƒã§ã‚‚æœ€ä½é™ã®å¼·åº¦ã‚’ä¿ã¤
    const devSecret = process.env.NODE_ENV === 'development' 
      ? 'dev-secret-key-minimum-32-chars-long-for-security'
      : undefined
    
    if (!devSecret) {
      throw new Error('JWT_SECRETç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')
    }
    
    console.warn('âš ï¸  é–‹ç™ºç’°å¢ƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆJWT_SECRETã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšç‹¬è‡ªã®å€¤ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚')
    return devSecret
  }
  
  if (secret.length < 32) {
    throw new Error('JWT_SECRETã¯32æ–‡å­—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚')
  }
  
  return secret
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
export async function registerUser(email: string, password: string): Promise<User> {
  const hashedPassword = await bcrypt.hash(password, 12)
  // ... SQLiteã¸ã®ä¿å­˜å‡¦ç†
}

// ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
export async function loginUser(email: string, password: string) {
  const user = await getUserByEmail(email)
  const isValid = await bcrypt.compare(password, user.password_hash)
  
  if (isValid) {
    const token = jwt.sign(
      { userId: user.id, email: user.email },
      getJwtSecret(),
      { expiresIn: '7d' }
    )
    return { user, token }
  }
  
  return null
}
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ èªè¨¼æƒ…å ±ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE platform_credentials (
  id TEXT PRIMARY KEY,
  platform_type TEXT NOT NULL UNIQUE,
  client_id TEXT,
  client_secret TEXT,
  access_token TEXT,
  refresh_token TEXT,
  expires_at DATETIME,
  is_active INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE audio_files (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  file_name TEXT NOT NULL,
  file_url TEXT NOT NULL,
  file_size INTEGER NOT NULL,
  duration INTEGER,
  status TEXT DEFAULT 'uploading',
  metadata TEXT DEFAULT '{}',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- é…ä¿¡ã‚¸ãƒ§ãƒ–ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE jobs (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  audio_file_id TEXT NOT NULL,
  job_type TEXT NOT NULL,
  status TEXT DEFAULT 'pending',
  result_url TEXT,
  error_message TEXT,
  progress INTEGER DEFAULT 0,
  platform_type TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (audio_file_id) REFERENCES audio_files(id) ON DELETE CASCADE
);

-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE uploads (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  file_path TEXT NOT NULL,
  processed_file_path TEXT,
  file_size INTEGER NOT NULL,
  mime_type TEXT NOT NULL,
  status TEXT DEFAULT 'uploading',
  metadata TEXT DEFAULT '{}',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- YouTubeèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE youtube_tokens (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  access_token TEXT,
  refresh_token TEXT NOT NULL,
  expires_at DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  status TEXT DEFAULT 'active',
  failure_count INTEGER DEFAULT 0,
  last_used_at DATETIME,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  UNIQUE(user_id)
);
```

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

```typescript
// éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼
const uploadFlow = async (audioFile: File) => {
  // 1. ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼
  const validation = await validateAudioFile(audioFile);
  if (!validation.isValid) {
    throw new Error(validation.error);
  }
  
  // 2. ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
  const savedFile = await saveAudioFile(audioFile);
  
  // 3. éŸ³å£°å‡¦ç†
  const processedAudio = await processAudio(savedFile);
  
  // 4. æ–‡å­—èµ·ã“ã—
  const transcript = await transcribeAudio(processedAudio);
  
  // 5. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
  const metadata = await saveMetadata({
    fileId: savedFile.id,
    transcript,
    duration: processedAudio.duration,
  });
  
  return { savedFile, processedAudio, transcript, metadata };
};
```

### 2. é…ä¿¡ãƒ•ãƒ­ãƒ¼

```typescript
// å¤šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é…ä¿¡ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼
const distributionFlow = async (audioFile: File, platforms: string[]) => {
  // 1. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ èªè¨¼æƒ…å ±ã®å–å¾—
  const credentials = await getPlatformCredentials(platforms);
  
  // 2. ä¸¦åˆ—é…ä¿¡å‡¦ç†
  const distributionPromises = platforms.map(async (platform) => {
    try {
      switch (platform) {
        case 'youtube':
          return await uploadToYouTube(audioFile, credentials.youtube);
        case 'voicy':
          return await uploadToVoicy(audioFile, credentials.voicy);
        case 'spotify':
          return await updateRSSFeed(audioFile);
        default:
          throw new Error(`Unsupported platform: ${platform}`);
      }
    } catch (error) {
      console.error(`${platform} upload failed:`, error);
      return { platform, success: false, error: error.message };
    }
  });
  
  // 3. çµæœã®åé›†
  const results = await Promise.allSettled(distributionPromises);
  
  // 4. ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°
  await updateJobStatus(results);
  
  return results;
};
```

## ğŸ¯ APIè¨­è¨ˆ

### RESTful APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```typescript
// èªè¨¼é–¢é€£
POST   /api/auth/login          # ãƒ­ã‚°ã‚¤ãƒ³
POST   /api/auth/register       # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
GET    /api/auth/me             # ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
GET    /api/auth/notifications  # èªè¨¼é€šçŸ¥å–å¾—

// ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
POST   /api/uploads             # éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
GET    /api/uploads/list        # ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—
GET    /api/uploads/lookup      # ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢
POST   /api/uploads/trim        # éŸ³å£°ãƒˆãƒªãƒŸãƒ³ã‚°
POST   /api/uploads/transcribe  # æ–‡å­—èµ·ã“ã—

// ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†
GET    /api/platforms           # ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¸€è¦§
POST   /api/platforms/voicy-credentials # Voicyèªè¨¼æƒ…å ±ä¿å­˜
POST   /api/platforms/voicy-upload # Voicyé…ä¿¡
GET    /api/platforms/youtube/auth # YouTubeèªè¨¼é–‹å§‹
GET    /api/platforms/youtube/callback # YouTubeèªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
POST   /api/platforms/youtube/upload # YouTubeé…ä¿¡
POST   /api/platforms/youtube/revoke # YouTubeèªè¨¼å»ƒæ£„

// RSS Feed
GET    /api/rss                 # RSS Feedå–å¾—
GET    /api/rss/archive         # RSSã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
GET    /api/rss/info            # RSSæƒ…å ±
GET    /api/rss/stats           # RSSçµ±è¨ˆæƒ…å ±

// ã‚¸ãƒ§ãƒ–ç®¡ç†
GET    /api/jobs                # ã‚¸ãƒ§ãƒ–ä¸€è¦§å–å¾—
POST   /api/jobs                # ã‚¸ãƒ§ãƒ–ä½œæˆ

// ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†
GET    /api/health              # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
POST   /api/init-db             # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
GET    /api/stats               # ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ
GET    /api/validate-rss        # RSSæ¤œè¨¼
```

### GraphQLã‚¹ã‚­ãƒ¼ãƒï¼ˆå°†æ¥ã®æ‹¡å¼µï¼‰

```graphql
type User {
  id: ID!
  email: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  audioFiles: [AudioFile!]!
  distributionJobs: [DistributionJob!]!
}

type AudioFile {
  id: ID!
  filename: String!
  originalName: String!
  fileSize: Int!
  duration: Float
  uploadedAt: DateTime!
  user: User!
  transcriptions: [Transcription!]!
}

type DistributionJob {
  id: ID!
  platform: String!
  status: JobStatus!
  metadata: JSON
  errorMessage: String
  createdAt: DateTime!
  updatedAt: DateTime!
  user: User!
  audioFile: AudioFile!
}

type Transcription {
  id: ID!
  transcript: String!
  language: String!
  createdAt: DateTime!
  audioFile: AudioFile!
}

enum JobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

type Query {
  user: User
  audioFiles: [AudioFile!]!
  distributionJobs: [DistributionJob!]!
  rssFeed: String!
}

type Mutation {
  uploadAudioFile(file: Upload!): AudioFile!
  transcribeAudio(fileId: ID!): Transcription!
  distributeToPlatform(fileId: ID!, platform: String!): DistributionJob!
  updateJobStatus(jobId: ID!, status: JobStatus!): DistributionJob!
}
```

## ğŸ”§ è¨­å®šç®¡ç†

### ç’°å¢ƒå¤‰æ•°ç®¡ç†

```typescript
// src/lib/env-config.ts
export const config = {
  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
  database: {
    path: './blogpostplatform.db',
    type: 'sqlite',
  },
  
  // OpenAIè¨­å®š
  openai: {
    apiKey: process.env.OPENAI_API_KEY!,
    model: 'whisper-1',
    maxTokens: 2000,
  },
  
  // YouTubeè¨­å®š
  youtube: {
    clientId: process.env.YOUTUBE_CLIENT_ID!,
    clientSecret: process.env.YOUTUBE_CLIENT_SECRET!,
    apiKey: process.env.YOUTUBE_API_KEY!,
    redirectUri: `${process.env.NEXT_PUBLIC_APP_URL}/api/platforms/youtube/callback`,
  },
  
  // Voicyè¨­å®š
  voicy: {
    email: process.env.VOICY_EMAIL!,
    password: process.env.VOICY_PASSWORD!,
    browserlessApiKey: process.env.BROWSERLESS_API_KEY!,
  },
  
  // Browserlessè¨­å®š
  browserless: {
    apiKey: process.env.BROWSERLESS_API_KEY!,
    wsEndpoint: `wss://chrome.browserless.io?token=${process.env.BROWSERLESS_API_KEY}`,
  },
  
  // ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š
  file: {
    maxSize: 2 * 1024 * 1024 * 1024, // 2GB
    allowedTypes: ['audio/mpeg', 'audio/wav', 'audio/mp4', 'audio/m4a', 'video/mp4', 'video/mov'],
    uploadDir: './uploads',
  },
  
  // éŸ³å£°å‡¦ç†è¨­å®š
  audio: {
    ffmpegPath: process.env.FFMPEG_PATH || 'ffmpeg',
    quality: process.env.AUDIO_QUALITY || '128k',
    format: process.env.AUDIO_FORMAT || 'mp3',
    silenceThreshold: process.env.SILENCE_THRESHOLD || '-50dB',
    silenceDuration: process.env.SILENCE_DURATION || '2.0',
  },
  
  // èªè¨¼è¨­å®š
  auth: {
    jwtSecret: process.env.JWT_SECRET || 'dev-secret-key-for-development-only',
    encryptionMasterKey: process.env.ENCRYPTION_MASTER_KEY!,
  },
};
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

```typescript
// ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
const cacheConfig = {
  // SQLite WALãƒ¢ãƒ¼ãƒ‰ï¼ˆWrite-Ahead Loggingï¼‰
  sqlite: {
    journalMode: 'WAL',
    synchronous: 'NORMAL',
    cacheSize: 1000,
    tempStore: 'MEMORY',
  },
  
  // ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
  memory: {
    maxSize: 100,
    ttl: 300, // 5åˆ†
  },
  
  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  file: {
    uploadDir: './uploads',
    processingDir: './processing',
    cacheControl: 'public, max-age=3600',
  },
  
  // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­å®šã‚­ãƒ£ãƒƒã‚·ãƒ¥
  platform: {
    configCacheTtl: 600, // 10åˆ†
    tokenCacheTtl: 1800, // 30åˆ†
  },
};
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

```sql
-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®šï¼ˆSQLiteï¼‰
CREATE INDEX IF NOT EXISTS idx_audio_files_user_id ON audio_files(user_id);
CREATE INDEX IF NOT EXISTS idx_jobs_user_id ON jobs(user_id);
CREATE INDEX IF NOT EXISTS idx_jobs_status ON jobs(status);
CREATE INDEX IF NOT EXISTS idx_uploads_user_id ON uploads(user_id);
CREATE INDEX IF NOT EXISTS idx_uploads_status ON uploads(status);
CREATE INDEX IF NOT EXISTS idx_uploads_created_at ON uploads(created_at);
CREATE INDEX IF NOT EXISTS idx_youtube_tokens_user_id ON youtube_tokens(user_id);

-- SQLiteå›ºæœ‰ã®æœ€é©åŒ–
PRAGMA journal_mode = WAL;
PRAGMA synchronous = NORMAL;
PRAGMA cache_size = 1000;
PRAGMA temp_store = MEMORY;
```

## ğŸ” ç›£è¦–ã¨ãƒ­ã‚°

### ãƒ­ã‚°è¨­å®š

```typescript
// src/lib/logger.ts
export class Logger {
  private static instance: Logger;
  
  static getInstance(): Logger {
    if (!Logger.instance) {
      Logger.instance = new Logger();
    }
    return Logger.instance;
  }
  
  info(message: string, metadata?: any) {
    console.log(`[INFO] ${new Date().toISOString()}: ${message}`, metadata);
  }
  
  error(message: string, error?: Error) {
    console.error(`[ERROR] ${new Date().toISOString()}: ${message}`, error);
  }
  
  warn(message: string, metadata?: any) {
    console.warn(`[WARN] ${new Date().toISOString()}: ${message}`, metadata);
  }
}
```

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†

```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
const metrics = {
  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚é–“
  uploadTime: new Histogram({
    name: 'file_upload_duration_seconds',
    help: 'Duration of file uploads',
    buckets: [0.1, 0.5, 1, 2, 5, 10],
  }),
  
  // é…ä¿¡æˆåŠŸç‡
  distributionSuccess: new Counter({
    name: 'distribution_success_total',
    help: 'Total successful distributions',
    labelNames: ['platform'],
  }),
  
  // APIå¿œç­”æ™‚é–“
  apiResponseTime: new Histogram({
    name: 'api_response_time_seconds',
    help: 'API response time',
    labelNames: ['endpoint'],
  }),
};
```

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### Railwayè¨­å®š

```json
// railway.json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "NODE_OPTIONS='--max-old-space-size=768' npm start",
    "healthcheckPath": "/api/health",
    "healthcheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### ä¾‹å¤–å‡¦ç†ã¨ãƒ¡ãƒ¢ãƒªç®¡ç†

```typescript
// src/lib/voicyAutomation.ts
export async function processVoicyUpload(options: VoicyUploadOptions) {
  let browser: Browser | null = null
  let page: Page | null = null
  
  try {
    // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
    const startMemory = process.memoryUsage()
    console.log(`ğŸš€ é–‹å§‹æ™‚ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${Math.round(startMemory.heapUsed / 1024 / 1024)}MB`)
    
    // Playwrightãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼èµ·å‹•
    if (process.env.NODE_ENV === 'development') {
      browser = await chromium.launch({ headless: false })
    } else {
      browser = await chromium.connectOverCDT({
        wsEndpoint: process.env.BROWSERLESS_WS_ENDPOINT!,
      })
    }
    
    page = await browser.newPage()
    
    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†å®Ÿè¡Œ
    await performVoicyUpload(page, options)
    
  } catch (error) {
    console.error('Voicyã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error)
    throw error
  } finally {
    // ãƒªã‚½ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    if (page) {
      await page.close()
    }
    if (browser) {
      await browser.close()
    }
    
    // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€çµ‚ç¢ºèª
    const endMemory = process.memoryUsage()
    console.log(`ğŸ“Š çµ‚äº†æ™‚ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${Math.round(endMemory.heapUsed / 1024 / 1024)}MB`)
  }
}
```

### Dockerè¨­å®šï¼ˆå°†æ¥ã®æ‹¡å¼µï¼‰

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
```

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦è³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€[GitHub Issues](https://github.com/yujiyamanaka/BlogPostPlatform/issues)ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚ 